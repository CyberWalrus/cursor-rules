---
id: 05-agent-mode-workflow
type: compact
response_language: ru
alwaysApply: true
---

# Agent Mode Workflow

<agent_mode_workflow>

<mode_check>
**CRITICAL CHECK:** This prompt works ONLY in Agent Mode!

**Activation check:**

- If system_reminder contains "Agent mode" or no mode specified ‚Üí proceed with agent workflow
- If Plan Mode is active (system_reminder contains "Plan mode is active") ‚Üí skip 05-agent-mode-workflow.mdc entirely
- If Ask Mode is active ‚Üí skip 05-agent-mode-workflow.mdc entirely
- If other mode active ‚Üí skip 05-agent-mode-workflow.mdc entirely

**Rule:** Without Agent Mode context, this prompt does not apply.
</mode_check>

**INSTANT EXECUTION - AUTONOMOUS AGENT MODE**

**–í–ê–ñ–ù–û: –í—Å–µ –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.**

**PROTOCOL PRIORITY:** Protocol over speed. Fast execution WITHOUT violating mandatory steps.

**PLAN-FIRST:** If plan exists ‚Üí follow todos sequentially, report progress after each.

**MANDATORY DOCS (before code/tests/fixes):**

**Why read docs:** Project-specific instructions may differ from general knowledge. 30 seconds reading ‚Üí 0 architectural violations.

REQUIRED: Read `.cursor/docs/naming.md`, `.cursor/docs/code-standards.md`, `.cursor/docs/testing.md`, `package.json`, `package-ai-docs.md` (if exist) ‚Üí verbalize: `[‚úì Docs read: naming, standards, testing]`

**CONTEXT7 CHECK (before external packages):**

REQUIRED: Before using external package ‚Üí call `mcp_context7_resolve-library-id` + `mcp_context7_get-library-docs` ‚Üí verify version/API compatibility

**WEB_SEARCH ESCALATION (unknown errors):**

REQUIRED: Unknown error persists 2+ attempts ‚Üí call `web_search` ‚Üí analyze solutions ‚Üí retry with findings

**UNIT TESTS ENFORCEMENT:**

MANDATORY: All `.ts/.tsx` code MUST have unit tests in `__tests__/` directory
EXCLUDE: `*.types.ts`, `*.constants.ts`, `*.schema.ts` (no tests needed)

**VALIDATION PROTOCOL:**

**Why validate simple files:** Even a 7-line file can contain architectural violations invisible to the eye. 10 seconds validation > 1 hour debugging in production.

After EACH file modification (search_replace/write/edit_notebook):

**VALIDATION MANDATORY (NO EXCEPTIONS):**

- ‚úì Every change ‚Üí validate (–¥–∞–∂–µ 1 line, –¥–∞–∂–µ –µ—Å–ª–∏ —É–∂–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª–∏, –¥–∞–∂–µ production fix)
- ‚úì Lint/tests pass ‚â† quality (MCP checks different aspects)
- ‚ùå NO exceptions for "small changes" or "later"

1. **VALIDATE:** Call `mcp_mcp-validator_validate` with correct type:
   - `.ts/.tsx/.js/.jsx` ‚Üí `'code'`
   - `.test.ts/.spec.ts` ‚Üí `'tests'`
   - `.mdc/.md` (in `.cursor/`) ‚Üí `'prompts'`
   - `architecture.xml` ‚Üí `'architecture'`
   - `package-ai-docs.md, module-ai-docs.md` ‚Üí `'documentation'`

2. **CHECK SCORE:** Target ‚â•85
   - Score ‚â•85 ‚Üí proceed to step 3
   - Score <85 ‚Üí apply fixes, re-validate (max 3 iterations)

3. **VERBALIZE:** Output: `[OK] File: [name] | Score: [X]/100 | Status: PASSED ‚úì`

‚ö†Ô∏è **REMINDER AFTER FILE MODIFICATION:**
Next mandatory step: 1) Call mcp_mcp-validator_validate 2) Verify score ‚â•85 3) Verbalize result

**BLOCKED ACTIONS:**

- ‚ùå Skip MCP validation (NO exceptions)
- ‚ùå Accept score <85 (NOT production-ready)
- ‚ùå Send response before ALL validations complete

**ANTI-PATTERN EXAMPLE:**

```
// ‚ùå WRONG: search_replace(file.ts) ‚Üí run_terminal_cmd("yarn lint")
// ‚úì CORRECT: search_replace(file.ts) ‚Üí mcp_mcp-validator_validate(...) ‚Üí yarn lint
```

**–¢–∏–ø–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞:** "1 —Å—Ç—Ä–æ–∫–∞ ‚Üí lint OK ‚Üí –ø—Ä–æ–ø—É—â—É MCP" | **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** "–õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí MCP –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"

**FINAL VERIFICATION:** Run lint/typecheck/tests from `package.json` ‚Üí 0 errors required

**ALGORITHM:**

1. Check plan ‚Üí follow todos sequentially
2. Read docs (if code/tests) ‚Üí naming.md, code-standards.md, testing.md, package.json, package-ai-docs.md
3. Check Context7 (if external packages) ‚Üí verify docs/versions
4. Execute task ‚Üí apply functional style, create unit tests
5. Validate EACH file ‚Üí follow VALIDATION PROTOCOL (‚â•85)
6. Search web (if unknown errors) ‚Üí analyze ‚Üí retry
7. Final checks ‚Üí run lint/typecheck/tests (0 errors)
8. AI Docs ‚Üí if code/architecture modified ‚Üí read `.cursor/docs/ai-docs-workflow.mdc` ‚Üí update `package-ai-docs.md`, `module-ai-docs.md`
9. **PRE-RESPONSE BARRIER:**

   **SELF-CHECK BEFORE RESPONDING:**
   - [ ] All modified files validated via MCP?
   - [ ] All scores ‚â•85?
   - [ ] Linter/type/test: 0 errors?
   - [ ] AI docs updated (if code/architecture changed)?
   - [ ] Final SUMMARY prepared?

   ‚ùå ANY unchecked ‚Üí FORBIDDEN to respond
   ‚úì ALL checked ‚Üí Proceed to report
10. Report ‚Üí list files with scores

**FALLBACKS:** MCP unavailable ‚Üí use lint/typecheck/tests | Validation fails ‚Üí iterate 3x | Task unclear ‚Üí ask

<completion_criteria>
üö® **MANDATORY PRE-RESPONSE GATE** üö®

- [ ] All modified files validated via MCP (scores ‚â•85)?
-[ ] Lint/type/test: 0 errors?

‚ùå ANY unchecked ‚Üí FORBIDDEN to respond | ‚úì ALL checked ‚Üí Proceed

---

**SUCCESS:** All todos done + ALL files validated (‚â•85) + verbalized + lint/typecheck/tests pass (0 errors)

**FAILURE:** File NOT validated | Score <85 | Linter/type/test errors | Missing scores in report

**FINAL STATEMENT (MANDATORY):**

```
[OK] SUMMARY: Modified [N] files | Validated [N] | All ‚â•85: YES | Lint/Type/Test: 0 errors | COMPLETE
```

</completion_criteria>

</agent_mode_workflow>
